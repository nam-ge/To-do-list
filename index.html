const todoInput = document.getElementById('todo-input');
const addBtn = document.getElementById('add-btn');
const todoList = document.getElementById('todo-list');

// ì•Œë¦¼ ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜
function playNotificationSound() {
    try {
        // Web Audio APIë¥¼ ì‚¬ìš©í•œ ê°„ë‹¨í•œ "ë ë§" ì†Œë¦¬ ìƒì„±
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(800, audioContext.currentTime); // 800Hz
        oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1); // 1ì´ˆ í›„ 1000Hz
        
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
        
    } catch (error) {
        console.log('ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', error);
        // ëŒ€ì²´ ë°©ë²•: ê¸°ì¡´ ì˜¤ë””ì˜¤ ìš”ì†Œ ì‚¬ìš©
        const notificationSound = document.getElementById('notification-sound');
        if (notificationSound) {
            notificationSound.currentTime = 0;
            notificationSound.play().catch(e => console.log('ëŒ€ì²´ ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e));
        }
    }
}

// ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
function showNotification(message) {
    // ê¸°ì¡´ ì•Œë¦¼ì´ ìˆë‹¤ë©´ ì œê±°
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4f8cff;
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        font-size: 16px;
        font-weight: 500;
        animation: slideIn 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // 3ì´ˆ í›„ ì•Œë¦¼ ì œê±°
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 300);
    }, 3000);
}

function addTodo() {
    const text = todoInput.value.trim();
    if (!text) return;
    
    const li = document.createElement('li');
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    
    // ë°˜ë³µ ì•Œë¦¼ íƒ€ì´ë¨¸ ë³€ìˆ˜
    let notificationTimer;
    let isCompleted = false;
    
    // ë°˜ë³µ ì•Œë¦¼ í•¨ìˆ˜
    function startRepeatingNotification() {
        if (isCompleted) return; // ì™„ë£Œë˜ì—ˆìœ¼ë©´ ì•Œë¦¼ ì¤‘ì§€
        
        showNotification(`${text} í• ì¼ì„ í•˜ì‹­ì‹œì˜¤`);
        
        // 15ë¶„ í›„ ë‹¤ì‹œ ì•Œë¦¼ (15ë¶„ = 900,000ë°€ë¦¬ì´ˆ)
        notificationTimer = setTimeout(startRepeatingNotification, 900000);
    }
    
    checkbox.addEventListener('change', function() {
        if (checkbox.checked) {
            todoText.classList.add('completed');
            isCompleted = true;
            // ì²´í¬í•˜ë©´ ì•Œë¦¼ íƒ€ì´ë¨¸ ì·¨ì†Œ
            if (notificationTimer) {
                clearTimeout(notificationTimer);
            }
        } else {
            todoText.classList.remove('completed');
            isCompleted = false;
            // ì²´í¬ í•´ì œí•˜ë©´ ë‹¤ì‹œ ì•Œë¦¼ ì‹œì‘
            startRepeatingNotification();
        }
    });
    
    const todoText = document.createElement('span');
    todoText.className = 'todo-text';
    todoText.textContent = text;
    
    const deleteBtn = document.createElement('button');
    deleteBtn.className = 'delete-btn';
    deleteBtn.innerHTML = 'ğŸ—‘ï¸';
    deleteBtn.onclick = function() {
        // ì‚­ì œí•  ë•Œë„ ì•Œë¦¼ íƒ€ì´ë¨¸ ì·¨ì†Œ
        isCompleted = true;
        if (notificationTimer) {
            clearTimeout(notificationTimer);
        }
        todoList.removeChild(li);
    };
    
    li.appendChild(checkbox);
    li.appendChild(todoText);
    li.appendChild(deleteBtn);
    todoList.appendChild(li);
    todoInput.value = '';
    todoInput.focus();
    
    // 15ë¶„ í›„ì— ì²« ë²ˆì§¸ ì•Œë¦¼ ì‹œì‘ (15ë¶„ = 900,000ë°€ë¦¬ì´ˆ)
    notificationTimer = setTimeout(startRepeatingNotification, 900000);
}

addBtn.addEventListener('click', addTodo);
todoInput.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') addTodo();
}); 
